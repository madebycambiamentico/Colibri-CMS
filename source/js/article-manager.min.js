/**
 * @author: nereo costacurta
 *
 * @project: colibrÃ¬ CMS | madebycambiamentico
 * @description: manage article.
 *
 * @require: [jquery.js >= 1.11.3], ./common.js, ./simple-modal-box.js, ./diatrics-remover.js
 *
 * @license: GPLv3
 * @copyright: (C)2016 nereo costacurta
**/
!function(){function e(e,t){FM_LIST.tiny=t,FM_LISTENER="tiny-"+e,openFM("file"===e?"all":e)}function t(t,a,r){return e(r.filetype,t),!1}tinymce.PluginManager.add("filemanager",function(t,a){t.addShortcut("Ctrl+E","",function(){FM_LIST.tiny=$.noop,e("all")}),t.addButton("manager",{text:"MBC",icon:"browse",tooltip:"File manager",shortcut:"Ctrl+E",onclick:function(){e("all",$.noop)}}),t.addMenuItem("manager",{text:"File manager",icon:"browse",shortcut:"Ctrl+E",context:"insert",onclick:function(){e("all",$.noop)}})}),tinymce.init({language:"it",selector:"textarea.tiny-area",plugins:["autolink link image lists hr preview code fullscreen insertdatetime media colorpicker textcolor autoresize table contextmenu filemanager"],menu:{format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},tools:{title:"Tools",items:"spellchecker code"}},toolbar:["insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent","forecolor backcolor link unlink | image media manager | code preview"],autoresize_max_height:320,file_picker_callback:t})}(),$(function(){var e={date:$("#art-smart-date").val(),prefix:"",setPrefix:function(){var t=$("#art-type").val();return"1"==t?e.prefix="":e.prefix=$("#art-type option:selected").data("prefix")+"/",e.update($("#art-title").val())},update:function(t){return t=removeDiacritics(t).replace(/\s+/g,"-").replace(/[?:;"#\\\/]/g,"").toLowerCase(),$("#art-smart-1").val(e.prefix+t),$("#art-smart-2").val(e.date+e.prefix+t),e}};$("#art-type").change(e.setPrefix),$("#art-title").change(function(){e.update(this.value)}),$("#art-fm-1").click(function(){FM_LISTENER=2,openFM("image")}),$("#art-fm-1-del").click(function(){$("#art-image").val(""),$("#art-thumb").css("background-image","")}),$(".save-arctic").click(function(){BUSY.start(),tinyMCE.triggerSave();var e=$("#art-body").val();if(e=$("<div>").html(e).html(),$("#art-body").val(e),""==$("#art-desc").val()){var t=$("<div>").html($("#my-article .tiny-area").val()).text().substr(0,156).replace(/\s+|\n/g," ");t.length>153&&(t=t.substr(0,153)+"..."),$("#art-desc").val(t)}$.post("database/article-add-or-edit.php",$("#my-article").serialize(),null,"json").success(function(e){return e.error?alert("ERRORE:\n"+e.error):void("insert"==e.success?($("#art-id").val(e.id),alert("Nuovo articolo inserito con successo!")):"update"==e.success&&alert("Aggiornamento completato con successo!"))}).error(function(e){console.log(e),alert("Oooops!")}).always(function(){BUSY.end(),$.get("sitemap-generator-generic.php").always(function(e){console.log(e)})})})});