/**
 * @author: nereo costacurta
 *
 * @project: colibrÃ¬ CMS | madebycambiamentico
 * @description: manage article.
 *
 * @require: [jquery.js >= 1.11.3], ./common.js, ./simple-modal-box.js, ./diatrics-remover.js
 *
 * @license: GPLv3
 * @copyright: (C)2016 nereo costacurta
 * @minified 2016/01/24
**/
!function(){function t(t,e){FM_LIST.tiny=e,FM_LISTENER="tiny-"+t,openFM("file"===t?"all":t)}function e(e,a,r){return t(r.filetype,e),!1}tinymce.PluginManager.add("filemanager",function(e,a){e.addShortcut("Ctrl+E","",function(){FM_LIST.tiny=$.noop,t("all")}),e.addButton("manager",{text:"MBC",icon:"browse",tooltip:"File manager",shortcut:"Ctrl+E",onclick:function(){t("all",$.noop)}}),e.addMenuItem("manager",{text:"File manager",icon:"browse",shortcut:"Ctrl+E",context:"insert",onclick:function(){t("all",$.noop)}})}),tinymce.init({language:"it",selector:"textarea.tiny-area",plugins:["autolink link image lists hr preview code fullscreen insertdatetime media colorpicker textcolor autoresize table contextmenu filemanager"],menu:{format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table",items:"inserttable tableprops deletetable | cell row column"},tools:{title:"Tools",items:"spellchecker code"}},toolbar:["insertfile undo redo | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent","forecolor backcolor link unlink | image media manager | code preview"],autoresize_max_height:320,file_picker_callback:e})}(),$(function(){var t={date:$("#art-smart-date").val(),prefix:"",setPrefix:function(){var e=$("#art-type").val();return"1"==e?t.prefix="":t.prefix=$("#art-type option:selected").data("prefix")+"/",t.update($("#art-title").val())},update:function(e){return e=removeDiacritics(e).replace(/\s+/g,"-").replace(/[?:;"#\\\/]/g,"").toLowerCase(),$("#art-smart-1").val(t.prefix+e),$("#art-smart-2").val(t.date+t.prefix+e),t}};$("#art-type").change(t.setPrefix),$("#art-title").change(function(){t.update(this.value)}),$("#art-fm-1").click(function(){FM_LISTENER=2,openFM("image")}),$("#art-fm-1-del").click(function(){$("#art-image").val(""),$("#art-thumb").css("background-image","")}),$(".save-arctic").click(function(){BUSY.start(),tinyMCE.triggerSave();var t=$("#art-body").val();if(t=$("<div>").html(t).html(),$("#art-body").val(t),""==$("#art-desc").val()){var e=$("<div>").html($("#my-article .tiny-area").val()).text().substr(0,156).replace(/\s+|\n/g," ");e.length>153&&(e=e.substr(0,153)+"..."),$("#art-desc").val(e)}$.post("database/article-add-or-edit.php",$("#my-article").serialize(),null,"json").success(function(t){return t.error?alert("ERRORE:\n"+t.error):void("insert"==t.success?($("#art-id").val(t.id),alert("Nuovo articolo inserito con successo!")):"update"==t.success&&alert("Aggiornamento completato con successo!"))}).error(function(t){console.log(t),alert("Oooops!")}).always(function(){BUSY.end()})})});