!function(){function e(){$("#user_waiters, #user_guests, #user_admins, #user_webmasters").each(function(){$(this).children('[id^="profile-"]').length?$(this).removeClass("has-no-pfs"):$(this).addClass("has-no-pfs")})}function s(e,s,a,n,o){if(n==o)return!1;console.log("I'm going to create profile: "+s+" #"+e+" class  "+n+" -> "+o);var r="";switch(o){case 0:r="user_guest";break;case 1:r="user_admin";break;case 2:r="user_webmaster";break;default:return!1}$contPosition=$("#"+r+"s .no-pfs"),r+="["+e+"]";var l='<div class="inputs maxi aligned" id="profile-'+o+"-"+e+'"><table class="profile-edit"><tr><td class="pf-td-img"><div class="pf-img _64" style="background-image:url(img/users/'+(a?e:"default")+'/face-64.png)"></div><div class="tools"><p><input type="radio" id="u_act_'+e+'_1" name="'+r+'[action]" value="1" checked><label for="u_act_'+e+'_1"><b class="sicon"><i class="v"></i></b></label><input type="radio" id="u_act_'+e+'_2" name="'+r+'[action]" value="2"><label title="Rifiuta" for="u_act_'+e+'_2"><b class="sicon"><i class="x"></i></b></label></p></div></td><td class="pf-td-tools"><h4 class="pf-name">'+printText(s)+"</h4>"+(2==i||0==o?'<h4>Assegna classe:</h4><p><select name="'+r+'[class]"><option value="0"'+(0==o?" selected":"")+'>Ospite</option><option value="1"'+(1==o?" selected":"")+">Amministratore</option>"+(2==i?'<option value="2"'+(2==o?" selected":"")+">Webmaster</option>":"")+"</select></p>":"")+"</td></tr></table></div>";$("#profile-"+n+"-"+e).remove(),$contPosition.before(l),t(e,s,a,n,o)}function t(e,s,t,a,i){2==i?$("#small_webmasters").append('<div id="small_webmaster_'+e+'" class="pf-img _32" style="background-image:url(\'img/users/'+(t?e:"default")+'/face-32.png\')" title="'+printAttr(s)+'"></div>'):2==a&&$("#small_webmaster_"+e).remove()}function a(t,a,i,n){console.log("sending "+n+" profiles to be updated...");var o=$(t+" input, "+t+" select").serialize();return""===o?!1:(BUSY.start(),$.post("database/"+i,o,null,"json").done(function(e){return console.log(e),e.error?alert("ERRORE:\n"+e.error):($.each(e.deleted,function(e,s){$("#profile-"+a+"-"+s).remove()}),void $.each(e.accepted,function(e,t){var i=$("#profile-"+a+"-"+e+" h4.pf-name").html(),n=0>a?!1:-1!=$("#profile-"+a+"-"+e+" .pf-img").css("background").indexOf("/default/");s(e,i,n,a,t["class"])}))}).fail(function(e){console.log(e),alert("Oooops!")}).always(function(){console.log(n+" profiles updated!"),e(),BUSY.end()}),!0)}var i=1;$(function(){i=$("#user_webmasters").length?2:1,e(),$("#saveNewUsers").click(function(){a("#user_waiters",-1,"user-_-update.php","WAITING")}),$("#saveGuestUsers").click(function(){a("#user_guests",0,"user-0-update.php","GUEST")}),2==i&&($("#saveAdminUsers").click(function(){a("#user_admins",1,"user-1-update.php","ADMIN")}),$("#saveWebmasterUsers").click(function(){return confirm("Attenzione! Se vengono rimossi tutti i webmaster, l'unico modo per poter gestire gli amministratori e il template del sito Ã¨ aggiungere manualmente un webmaster al database!\n\nCONTINUARE COMUNQUE?")?void a("#user_webmasters",2,"user-2-update.php","WEBMASTER"):!1}))})}();