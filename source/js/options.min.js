$(function(){function e(e){var t="";$.each(e,function(e,a){t+='<input type="hidden" name="langs[]" value="'+printAttr(a)+'">'}),$("#lang-supported").html(t)}var t=!1,a=$("#lang-options, #lang-open");$("#ismultilang").change(function(){this.checked?t?a.removeClass("hidden"):(t=!0,$.get("database/languages-get-all.php",null,null,"json").done(function(t){if(t.error!==!1)return alert("ERRORE:\n"+t.error);console.log(t);var l="",n="",o=[];$.each(t.languages,function(e,t){l+='<label><input value="'+printAttr(t.c)+'" type="checkbox"'+("1"==t.x?" checked":"")+"> <i>"+printText(t.n)+"</i></label>",n+='<option value="'+printAttr(t.c)+'"'+("1"==t.x?" selected":"")+">"+printText(t.n)+"</option>","1"==t.x&&o.push(t.c)}),$("#lang-codes").html(l),$("#lang-default").html(n),a.removeClass("hidden"),e(o)}).fail(function(e){alert("Ooops!"),console.log(e)}).always(function(){BUSY.end()})):a.addClass("hidden")}).change(),$("#lang-open, #lang-apply").click(function(){$("#languages-pop").modalbox()}),$("#languages-pop")[0].modalbox.on.close=function(){var t=[];$("#languages-pop input:checked").each(function(){t.push(this.value)}),e(t)},$(".save-arctic").click(function(){BUSY.start(),$.post("database/website-edit.php",$("#my-article").serialize(),null,"json").done(function(e){return e.error!==!1?alert("ERRORE:\n"+e.error):void alert("Sito aggiornato correttamente")}).fail(function(e){alert("Ooops!"),console.log(e)}).always(function(){BUSY.end()})});var l=!1;$("#templates-pop .popup").on("scroll.lazy",checkLoadImage),$("#change-template").click(function(){$("#templates-pop").modalbox("open"),$.get("database/website-templates.php",null,null,"json").done(function(e){if(console.log(e),e.error!==!1)return alert("Errore:\n"+e.error);if(l)return updateView("#templates-pop"),!1;l=!0;var t=$("#w-templ").val(),a=new Array(e.templates.length);$.each(e.templates,function(e,l){a[e]='<div id="template-'+e+'" class="template"><div class="imgcont load" data-thumb="templates/'+printAttr(l.folder)+'/screenshots/0.png"><label class="image"><input id="w-templ-'+e+'" name="newtemplate" type="radio" value="'+printAttr(l.folder)+'"'+(t==l.folder?" checked":"")+"></label></div><p><b>Titolo:</b> "+printText(l.name)+"</p><p><b>Autore:</b> "+printText(l.author)+"</p><p><b>Descrizione:</b> "+printText(l.description).replace("s+"," ")+'</p><div class="tools">'+("web"in l?'<p><a target="_blank" href="'+printAttr(l.web[0])+'" title="'+printAttr(l.web[1])+'"><b class="sicon"><i class="star"></i></b> Sito di riferimento</a></p>':"")+'<p><label for="w-templ-'+e+'"><b class="sicon"><i class="hearth"></i></b> SCEGLI</label></p></div></div>'}),$("#all-templates").html(a.join("")),$("#all-templates input").change(function(){var e=this.value;$.get("database/website-edit-template.php",{template:e},null,"json").done(function(t){if(console.log(t),t.error)return alert("ERRORE:\n"+t.error);$("#my-template p, #my-template .tools").remove(),$("#w-templ").val(e);var a=$("#my-template .imgcont").css("background-image").replace(/templates\/[a-z0-9_\- ]+\//i,"templates/"+e+"/");$("#my-template .imgcont").css("background-image",a),$("#templates-pop").modalbox("close")}).fail(function(e){alert("Ooops!"),console.log(e)})}),updateView("#templates-pop")}).fail(function(e){alert("Ooops!"),console.log(e)})})});