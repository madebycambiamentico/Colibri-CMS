/**
 * @author: nereo costacurta
 *
 * @project: colibrì CMS | madebycambiamentico
 * @description: manage articles quick edits, restore, move to trash and complete deletions.
 *
 * @require: [jquery.js >= 1.11.3], ./common.js, ./modalbox.js
 *
 * @license: GPLv3
 * @copyright: (C)2016 nereo costacurta
 * @minified 2016/02/06
**/
!function(){function t(){BUSY.start(),$.post("database/article-quick-edit.php",$("#edit-article").serialize(),null,"json").success(function(t){if(t.error)return alert("ERRORE:\n"+t.error);$("#art-"+t.id+" input.quick-mod").data({idx:t.idx,mnu:t.mnu,img:t.img,idxl:t.idxl,lang:t.lang}),t.img?$("#art-"+t.id+" label.art-img").css("background-image","url('img/thumbs/"+printAttr(t.img)+"')"):$("#art-"+t.id+" label.art-img").css("background-image","");var e=' <i class="art-type">('+printText(artTypes[$("#art-"+t.id+" .art-props h4").data("t")].n)+")</i>";$("#art-"+t.id+" .art-props h4").text(t.title).append(e),$("#art-"+t.id+" .art-desc").text(t.desc),$("#art-"+t.id).setFigureTitle(t.title,t.desc),$("#quick-edit-art").modalbox("off")}).error(function(t){console.log(t),alert("Oooops!")}).always(function(){BUSY.end()})}function e(t){if(!t||"garbage=1"==t)return!1;BUSY.start();var e=$.isArray(t)?ISGARBAGE?{trash:t,isgarbage:!0}:{trash:t}:t;$.post("database/article-garbage.php",e,null,"json").success(function(e){return e.error?alert("ERRORE:\n"+e.error):(t="#art-"+e.ids.join(",#art-"),void $(t).remove())}).error(function(t){console.log(t),alert("Oooops!")}).always(function(){BUSY.end()})}function r(t){if(!t||"garbage=1"==t)return!1;BUSY.start();var e=$.isArray(t)?{trash:t}:t;$.post("database/article-resurrect.php",e,null,"json").success(function(e){return e.error?alert("ERRORE:\n"+e.error):(t="#art-"+e.ids.join(",#art-"),void $(t).remove())}).error(function(t){console.log(t),alert("Oooops!")}).always(function(){BUSY.end()})}$.fn.setFigureTitle=function(t,e){return this.each(function(){$(this).attr("data-t",t?t.toLowerCase():$(this).find(".art-props h4").text().toLowerCase()).attr("data-c",e?e.toLowerCase():$(this).find(".art-desc").text().toLowerCase())})},$.fn.quickEdit=function(){return this.change(function(){var t=this.value,e=$(this).data();$("#eart-id").val(t),$("#eart-wasindex").val(e.idx),$("#eart-wasindexlang").val(e.idxl),$("#eart-isinmenu").prop("checked",e.mnu),$("#eart-isindex").prop("checked",e.idx),$("#eart-isindexlang").prop("checked",e.idxl),$("#eart-lang").val(e.lang),$("#eart-image").val(e.img),$("#eart-title").val($($("#art-"+t+" .art-props h4").contents()[0]).text().trim()).change(),$("#eart-desc").val($("#art-"+t+" .art-desc").text()),i.setPrefix(e.t+""),$("#quick-edit-art").modalbox()})},$.fn.quickDel=function(){return this.click(function(){var t=$(this).data("id");ISGARBAGE?"Verrà eliminato definitivamente e non sarà più recuperabile.":"L'articolo sarà ancora disponibile nel cestino se cambi idea.";return confirm("Sei sicuro di voler cancellare l'articolo \""+$("#art-"+t+" .art-props h4").text()+'"?\n')?void e([t]):!1})},$.fn.quickResurr=function(){return this.click(function(){var t=$(this).data("id");r([t])})};var i={date:$("#eart-smart-date").val(),prefix:"",setPrefix:function(t){return $("#eart-type").val(t),1==t?i.prefix="":i.prefix=artTypes[t].pfx+"/",i.update($("#eart-title").val())},update:function(t){return t=removeDiacritics(t).replace(/\s+/g,"-").replace(/[?:;"#\\\/]/g,"").toLowerCase(),$("#eart-smart-1").val(i.prefix+t),i}},a={f_type:"",f_title:"",f_desc:"",setTitle:function(t){return""===t?a.f_title="":a.f_title='[data-t*="'+printAttr(t)+'"]',a.checkFilter(),this},setDesc:function(t){return""===t?a.f_desc="":a.f_desc='[data-c*="'+printAttr(t)+'"]',a.checkFilter(),this},setType:function(t){return"0"===t?a.f_type="":a.f_type=".type-"+t,a.checkFilter(),this},checkFilter:function(){return""===a.f_type&&""===a.f_title&&""===a.f_desc?$("#all-articles").removeClass("filtering"):($("#all-articles").addClass("filtering"),a.updateSearch()),updateView(),this},updateSearch:function(){return $("#all-articles .art-cont").removeClass("show"),$("#all-articles .art-cont"+a.f_type+a.f_title+a.f_desc).addClass("show")}};$(function(){$("#eart-title").change(function(){i.update(this.value)}),updateView("#all-articles",!0),$("#all-articles .art-cont").setFigureTitle(),$("#filtertype").change(function(){a.setType(this.value)}),$("#search-title").keyup(function(){a.setTitle(this.value)}),$("#search-desc").keyup(function(){a.setDesc(this.value)}),$("#sel-all").change(function(){$("#all-articles .art-img input").prop("checked",!1),$("#all-articles .art-cont"+a.f_type+a.f_title+a.f_desc+" .art-img input").prop("checked",!0)}),$("#desel-all").change(function(){$("#all-articles .art-img input").prop("checked",!1)}),$("#del-all").change(function(){var t=ISGARBAGE?"Verranno eliminati definitivamente e non saranno più recuperabili.":"Saranno ancora disponibili nel cestino se cambi idea.";return confirm("Sei sicuro di voler cancellare tutti gli articoli selezionati?\n"+t)?void e($("#my-article").serialize()):!1}),$("#resurr-all").change(function(){r($("#my-article").serialize())}),$(".quick-mod").quickEdit(),$(".quick-delete").quickDel(),$(".resurrect").quickResurr(),$("#saveArctic").click(t),$("#eart-fm-1").click(function(){FM_LISTENER=1,openFM("image")}),$("#eart-fm-1-del").click(function(){$("#eart-image").val("")})})}();