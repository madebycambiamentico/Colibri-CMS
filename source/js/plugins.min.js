!function(){function n(){l.length&&(purge=0,l.each(function(){isInWindow(this)&&(this.pluginBox.updateInfo(),this.pluginBox.$box.removeClass("info-loading"),purge++)}),purge&&(l=$("#all-plugins .info-loading")))}function i(n,i){$("#pl-info-title").text(n.title),$("#pl-info-logo").css("background-image",i),$("#pl-info-author").text(n.author),$("#pl-info-version").text(n.version),$("#pl-info-desc").html(n.require)}function o(n,o,l){function e(){console.log("completing (de)installation for plugin "+s.plugin.author+" > "+s.plugin.title),$.post("plugin/toggle-install.php",{p:s.plugin.idx},null,"json").done(function(n){return n.error?alert("Errore\n"+n.error):(c=n.installed,console.log("plugin "+s.plugin.author+" > "+s.plugin.title+" has been "+(c?"":"un-")+"installed."),void(c?s.$box.removeClass("install"):s.$box.addClass("install")))}).fail(function(n){console.log(n),alert("Ooops!")}).always(function(){x.end()})}function u(){s.$info.html("<h4>"+s.plugin.title+" di <i>"+s.plugin.author+'</i></h4><p class="version" data-version="'+printAttr(s.plugin.version)+'"><code>v.'+printText(s.plugin.version)+"</code></p>")}function r(){return v?(i(s.plugin,s.$box.find(".logo").css("background-image")),void v.modalbox("open")):!1}function a(){if(!h)return!1;var n=h.find("iframe")[0];n.src!==f&&(n.src=f),h.modalbox("open")}var s=this,p=!1,c=!1,g=!1,f=null,d=!1,v=null,h=null;s.$box=null,s.$info=null,s.$loader=null,s.plugin=null,s.init=function(n,i,o){if(!n||!i)return!1;if(s.$box)return!1;n[0].pluginBox=s,s.$box=n,s.$info=n.find(".info"),v=i?i:null,h=o?o:null,haslogo=n.find(".logo").css,c=!n.hasClass("install"),g=n.hasClass("active"),f=function(){var i=n.find(".plugin-custom");return i.length?i.click(function(n){n.preventDefault(),s.openCustom()})[0].href:null}();var l=n.find(".plugin-install").click(function(n){n.preventDefault(),s.install()}).data("plugin");return n.find(".plugin-activate").click(function(n){n.preventDefault(),s.activate()}),s.plugin={url:l},l=l.match(/\/([a-z0-9]+)\/([a-z0-9]+)\/$/i),s.plugin.author=l[1],s.plugin.title=l[2],s.plugin.idx=l[1]+"/"+l[2],n.find(".plugin-info input").change(s.openInfo),s.$loader=n.find(".loader p"),s};var x={start:function(n){n||(n="occupato..."),n=s.plugin.author+" "+s.plugin.title+" "+n,console.log(n),d=!0,s.$loader.html(n),s.$box.addClass("loading")},end:function(){d=!1,s.$box.removeClass("loading")}};return s.install=function(){return!s.plugin||d?!1:(x.start("installazione in corso"),void $.post(s.plugin.url+"installer.php",{install:!c},null,"json").done(function(n){return n.error?(x.end(),alert("Errore\n"+n.error)):void e()}).fail(function(n){console.log(n),x.end(),alert("Ooops!")}))},s.activate=function(){return c&&s.plugin&&!d?(x.start("attivazione in corso"),void $.post("plugin/toggle-active.php",{p:s.plugin.idx},null,"json").done(function(n){return n.error?alert("Errore\n"+n.error):(g=n.active,console.log("plugin "+s.plugin.author+" > "+s.plugin.title+" has been "+(g?"":"de-")+"activated."),void(g?s.$box.addClass("active"):s.$box.removeClass("active")))}).fail(function(n){console.log(n),alert("Ooops!")}).always(function(){x.end()})):!1},s.updateInfo=function(n,i){return!s.plugin||d?!1:(x.start("ricerca info"),void $.get(s.plugin.url+"director.json",null,null,"json").done(function(i){s.plugin=$.extend(s.plugin,i),p=!0,u(),n&&n()}).fail(function(n){console.log(n),alert("Ooops!"),i&&i()}).always(function(){x.end()}))},s.openInfo=function(){return!s.plugin||d?!1:(p?r():s.updateInfo(r),s)},s.openCustom=function(){return!f||d?!1:(a(),s)},n&&s.init(n,o,l),s.id=t.push(s)-1,s.$box[0].id="-box-"+s.id,s}var l=[],t=[];$.fn.pluginBox=function(){var n=$("#plugin-info"),i=$("#plugin-custom-page");return this.each(function(){new o($(this),n,i)})},$(function(){$("#all-plugins .plugin-box").pluginBox(),l=$("#all-plugins .info-loading"),$(this).on("scroll.lazy resize.lazy",n),n()})}();