/*
* Autoadapt Mosaic Grid Gallery - jQuery plugin
* @version 2.3
* @copyright 2016, Nereo Costacurta [MadeByCambiamentico]
* @site: http://cambiamentico.altervista.org
*
* @license: GPLv3 (https://www.gnu.org/licenses/gpl.html)
* free for non-commercial use.
* for commercial use, a little donation is welcome.
*/
!function(){function i(i,t,s,n){var a=new Image;a.onload=function(){t&&t(a),n&&n()},a.onerror=function(){return s&&s(),n&&n(),!1},a.src=i}function t(i,t){i=$.extend({attr:{},data:{}},i);var s=$("<a>").attr(i.attr);$.each(i.data,function(i,t){s.attr("data-"+i,t)});var n=$('<div class="overlay">').text(i.attr.title||i.data.title||" ");return t(s),s.append(n)}function s(){}function n(n,a){function e(){if(r<a.imgs.length){for(;r<a.imgs.length;)if(null!==a.imgs[r]){a.imgs[r].box.addClass("show"),r++;break}setTimeout(function(){e()},a.popSpeed)}}function g(){m=a.maxD;for(var i,t,s=0,n=0,g=0,h=d,o=0,r=d;r<a.imgs.length;r++)if(o++,null!==a.imgs[r]){if(g++,a.imgs[r].box.removeClass("first last"),a.imgs[r].height<m){m=a.imgs[r].height,i=r,s=0;for(var f=h;r>=f;f++)null!==a.imgs[f]&&(a.imgs[f].wi=Math.round(a.imgs[f].width*m/a.imgs[f].height),s+=a.imgs[f].wi)}else a.imgs[r].wi=Math.round(a.imgs[r].width*m/a.imgs[r].height),s+=a.imgs[r].wi;if(t=s+(g-1)*a.pad,n+=a.imgs[r].ar,t>=l&&(g>=a.minN||h+o===a.imgs.length)){m=(l-(g-1)*a.pad)/n,s=0;for(var f=h;h+o>f;f++)null!==a.imgs[f]&&(a.imgs[f].wi=Math.round(a.imgs[f].width*m/a.imgs[f].height),s+=a.imgs[f].wi);var u=s+(g-1)*a.pad-l;if(u>0)for(var f=h;h+u>f&&h+o>f;f++)null!==a.imgs[f]&&a.imgs[f].wi--;for(var f=h;h+o>f;f++)null!==a.imgs[f]&&a.imgs[f].box.css({width:a.imgs[f].wi+"px",height:m+"px"});a.imgs[h].box.addClass("first"),a.imgs[h+o-1].box.addClass("last"),d=h,h+=o,o=0,g=0,s=0,n=0,m=a.maxD}else if(h+o===a.imgs.length){for(var f=h;f<a.imgs.length;f++)null!==a.imgs[f]&&a.imgs[f].box.css({width:a.imgs[f].wi+"px",height:m+"px"});a.imgs[h].box.addClass("first"),a.imgs[a.imgs.length-1].box.addClass("last"),d=h}h+o===a.imgs.length&&setTimeout(e,20)}}if(!n.length)return!1;a=$.extend({pad:5,maxD:1e3,minN:1,popSpeed:200,onAdd:s,imgs:null},a);var h,m,o=1,d=0,r=0,l=Math.ceil(n.innerWidth())-o,f=!1;if(!a.imgs){var u=n.find(".box");if(!u.length)return!1;f=!0,a.imgs=new Array(u.length),u.each(function(i){var t=$(this).find("img");t.length?a.imgs[i]={box:$(this),img:t[0],src:t[0].src}:$(this).remove()})}h=a.imgs.length,n.append('<div class="loader"><p></p></div>').addClass("loading"),$.each(a.imgs,function(s,e){i(e.src,function(i){if(h--,a.imgs[s].wi=i.width,a.imgs[s].width=i.width,a.imgs[s].hi=i.height,a.imgs[s].height=i.height,a.imgs[s].ar=i.width/i.height,!f){$('<div class="overlay">').html("string"==typeof a.imgs[s].attr.title?a.imgs[s].attr.title:"");a.imgs[s].box=$('<div class="box">').append(t(a.imgs[s],a.onAdd)).append(i)}},function(){h--,f&&a.imgs[s].box.remove(),a.imgs[s]=null},function(){if(!h){if(n.removeClass("loading"),!f)for(var i=0;i<a.imgs.length;i++)null!==a.imgs[i]&&n.append(a.imgs[i].box);g()}})}),$(window).on("resize.aagallery",function(){d=0,tempW=Math.round(n.innerWidth())-o,l!==tempW&&(l=tempW,g())}),this.add=function(s){return h?!1:(n.addClass("loading"),h=s.length,void $.each(s,function(s,e){i(e.src,function(i){h--,a.imgs.push({src:i.src,wi:i.width,width:i.width,hi:i.height,height:i.height,ar:i.width/i.height,box:$('<div class="box">').append(t(e,a.onAdd)).append(i).appendTo(n)})},function(){h--},function(){h||(n.removeClass("loading"),g())})}))}}$.fn.adaptiveGallery=function(i){return this.each(function(){this.adaptiveGallery=new n($(this),i)})}}();