var CommentsStore=function(a){"use strict";function e(a){return a?a.replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function f(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function i(c,d,j,k,l,m,n){function q(a,c,d,g,h,i,j){o.$comment=$('<div class="cmt-comment'+(i?" cmt-hasnext":"")+(h?" cmt-haschild":"")+'"><div class="cmt-lines"><a name="cc'+a+'"></a><p class="cmt-toparent"></p><p class="cmt-tochild"></p><p class="cmt-toprofile"></p><p class="cmt-circle" title="#'+a+'"></p><img src="'+b+"img/users/"+(c.id&&c.hasimage?c.id:"default")+'/face-32.png"></div><a href="#cc'+a+'" class="cmt-author">'+f(c.name)+'</a> <i class="cmt-date">('+d+")</i>: "+g+(c.website?'<a href="'+e(c.website)+' target="_blank" class="cmt-site">website</a>':"")+(j?'<a class="cmt-reply">Reply</a>':"")+"<hr></div>"),o.$replies=$('<div class="cmt-boxes"><p class="cmt-link"></p></div>'),o.$box=$('<div class="cmt-box" id="-cmt-'+a+'"></div>').append(o.$comment).append(o.$replies)}var o=this;o.$box=null,o.$comment=null,o.$replies=null,o.id=!1;var p=!!l;return o.init=function(b,c,d,e,f,i,j){return!!(!1===o.id&&b&&c&&d&&e)&&(o.id=g++,h[b]=o,q(b,c,d,e,f,i,j.length),p=f,o.$box.find(".cmt-circle").click(function(){p&&o.$box.toggleClass("open").delay(1).dclass(2,"fancy")}),j.length&&o.$box.find(".cmt-reply").click(function(c){c.preventDefault(),j.modalbox("open"),$("#CC_COMMENT_ID").val(b),"TINY"in a&&tinyEditor.clear()}),o)},o.update={hasNext:function(a){return a===!1?o.$comment.removeClass("cmt-hasnext"):o.$comment.addClass("cmt-hasnext"),o},hasChild:function(a){return p==a?o:(a===!1?(p=a,o.$comment.removeClass("cmt-haschild")):(p=!0,o.$comment.addClass("cmt-haschild")),o)}},o.addReplies=function(a,b){if(!a.length)return o;if(b){var c=o.$replies.children(".cmt-box:last-child");c.length&&(c=c[0].id.replace("-cmt-",""),h[c].update.hasNext())}for(var d=0;d<a.length;d++)a[d]instanceof i?o.$replies.append(a[d].$box):o.$replies.append(a[d]);return o.update.hasChild()},o.init(c,d,j,k,l,m,n)}function j(){$("#CC_COMMENT").removeClass("no-support"),new TINY.editor.edit("tinyEditor",{id:"CC_COMMENT",controls:["bold","italic","|","orderedlist","unorderedlist","|","unformat","|","undo","redo"],footer:!0,xhtml:!1,toggle:{text:"show source",activetext:"show wysiwyg",cssclass:"toggle"},resize:{cssclass:"resize"}})}"console"in a||(console={info:$.noop,log:$.noop,warn:$.noop,error:$.noop});var b="",c="plugin/Colibri/Comments/",d=0;$.cachedScript=function(a,b){return b=$.extend(b||{},{dataType:"script",cache:!0,url:a}),$.ajax(b)};var g=0,h={};return $.fn.extend({dclass:function(a,b){return $(this).queue(function(c){switch(a){case 0:$(this).removeClass(b);break;case 1:$(this).addClass(b);break;default:$(this).toggleClass(b)}c()})}}),$(function(){function l(){function b(){a=(new Date).getTime()-a,a<2e3?setTimeout(function(){g.removeClass("loading")},2e3-a):g.removeClass("loading"),console.info("Colibrì Comments (c) loaded ["+a+"ms].")}function h(a,b,c){var d=b;if(!f[b])return!1;var g=f[b],j=new i(g.cid,g.a,g.d,g.c,g.cld,g.nxt,e);if(b++,g.cld){var k=h(j,b,!0);b=k.i}var l=[j.$box];if(c&&g.nxt)for(var m=g.o.length;b<f.length&&m<=f[b].o.length;){var k=h(a,b,!1);l.push(k.cc.$box),b=k.i}if(a instanceof i)a.addReplies(l);else if(0===d)for(var n=0;n<l.length;n++)a.append(l[n]);return{i:b,cc:j}}console.info("Loading Colibrì Comments (c)..."),g.addClass("loading");var a=(new Date).getTime(),f=[];$.get(c+"template/get-comments.php?",{pageid:d},null,"json").done(function(a){if(a.error)return alert("Errore\n"+a.error);f=a.comments;for(var b=!1,c=!1,d=0;d<f.length;d++){b=!1,f[d+1]&&f[d].o.length<f[d+1].o.length&&(b=!0),c=!1;for(var e=d+1;e<f.length&&!(f[d].o.length>f[e].o.length);e++)if(f[d].o.length==f[e].o.length){c=!0;break}f[d].cld=b,f[d].nxt=c}h(k,0,!0),a.comments.length&&k.removeClass("empty")}).fail(function(a){alert("Ooops!"),console.warn(a)}).always(function(a){b()}),o(!0),l=$.noop}function n(){function b(b){var c=b.getBoundingClientRect();return c.top<=50&&c.bottom>=a.innerHeight-50||c.top>=50&&c.top<=a.innerHeight-50||c.bottom>50&&c.bottom<a.innerHeight-50}return!m&&"off"!==m&&(m=!0,void $(a).on("scroll.ccmt resize.ccmt",function(){b(k[0])&&l()}).trigger("resize.ccmt"))}function o(b){$(a).off("scroll.ccmt resize.ccmt"),m=!!b&&"off"}function p(a){function c(a,c){switch(console.info("Update Colibrì Comments preference to "+a),a){case"0":k.removeClass("closed").delay(5).dclass(1,"fancy"),n();break;case"1":k.addClass("closed").removeClass("fancy"),n();break;case"2":k.addClass("closed").removeClass("fancy"),o()}return c&&$(b+"[value="+a+"]").prop("checked",!0),a}var b="#colibri-comment-info-popup input[name=CC_SHOW]";$(b).change(function(){docCookies.setItem("ccmt",c(this.value,!1),604800,"/",null,null)}).filter(":checked").val();a?c(a,!0):c("0",!1)}if(b=$("#CC_PATH").val(),c=b+c,d=$("#CC_PAGE_ID").val(),!d||"0"==d)return!1;var e=$("#colibri-comment-popup"),f=$("#colibri-comment-info-popup"),g=$("#colibri-comments"),k=$("#cmt-all");$(".cmt-btn-info").click(function(){f.modalbox()}),e.length?($("#cmt-all>.cmt-plus").click(function(){e.modalbox("open"),$("#CC_COMMENT_ID").val(""),"TINY"in a&&tinyEditor.clear()}),"execCommand"in document&&e.modalbox(null,{open:function(a){function f(a){a||(d=(new Date).getTime()-d,d<2e3?setTimeout(function(){e.removeClass("loading")},2e3-d):e.removeClass("loading"),console.info("Addon plugins loaded in "+d+"ms"))}e.addClass("loading");var b=1,d=(new Date).getTime();console.info("Loading TinyEditor plugin..."),$.cachedScript(c+"TinyEditor/tinyeditor.colibri.min.js?v=2").done(function(){console.info("TinyEditor plugin loaded."),j()}).fail(function(a){alert("Ooops!"),console.warn(a)}).always(function(){f(--b)}),a.on.open=$.noop}},!0).append('<div class="cmt-loader"></div>'),$("#colibri-comment-popup form").submit(function(b){b.preventDefault();var c=this.action;if(!c)return!1;var d;if(d="TINY"in a?tinyEditor.post().trim():$("#CC_COMMENT").val().trim(),!d||d.length<10)return alert("Il tuo commento è troppo corto!"),!1;if("1"!==$("#CC_LOGGED").val()){if(d=$("#CC_NAME").val(),!d||d.length<4)return alert("Il tuo nome è troppo corto!"),!1;if(d=$("#CC_EMAIL").val(),!d||d.length<4||!/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/.test(d))return alert("L'email non è valida."),!1}var f=$("#CC_COMMENT_ID").val();e.addClass("loading"),$.post(c,$(this).serialize(),null,"json").done(function(a){if(a.error)return alert("Errore\n"+a.error);var b=a.comment,c=new i(b.cid,b.a,b.d,b.c,!1,!1,e);f&&f in h?h[f].addReplies([c.$box],!0):($("#cmt-all > .cmt-box:last-child > .cmt-comment").addClass("cmt-hasnext"),k.append(c.$box)),alert("Commento aggiunto!"),k.removeClass("empty"),e.modalbox("close")}).fail(function(a){alert("Ooops!"),console.warn(a)}).always(function(a){e.removeClass("loading")})})):k.addClass("no-reply");var m=!1;"docCookies"in a?p(docCookies.getItem("ccmt")):(console.info("Loading Cookie plugin..."),$.cachedScript(c+"js/cookie.min.js").done(function(){console.info("Cookie plugin loaded"),p(docCookies.getItem("ccmt"))}).fail(function(a){alert("Ooops!"),console.warn(a)}))}),h}(window);